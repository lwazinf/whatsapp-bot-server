generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum OrderStatus {
  PENDING
  PAID
  READY_FOR_PICKUP
  COMPLETED
  CANCELLED
}

enum MerchantStatus {
  ONBOARDING
  ACTIVE
  SUSPENDED
}

model UserSession {
  id             String   @id @default(cuid())
  wa_id          String   @unique
  mode           String   @default("CUSTOMER")
  state          String?
  active_prod_id String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model Merchant {
  id                String         @id @default(cuid())
  wa_id             String         @unique
  handle            String         @unique
  trading_name      String
  legal_entity_name String?
  id_number         String?
  description       String?
  address           String?
  image_url         String?
  logo_image_url    String?
  bank_name         String?
  bank_acc_no       String?
  bank_type         String?
  open_time         String         @default("08:00")
  close_time        String         @default("18:00")
  sat_open_time     String         @default("10:00")
  sat_close_time    String         @default("15:00")
  sun_open          Boolean        @default(false)
  manual_closed     Boolean        @default(false)
  accepted_terms    Boolean        @default(false)
  status            MerchantStatus @default(ACTIVE)
  products          Product[]
  orders            Order[]
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
}

model Product {
  id          String      @id @default(cuid())
  merchant_id String
  merchant    Merchant    @relation(fields: [merchant_id], references: [id])
  name        String
  description String?
  price       Float
  image_url   String?
  is_in_stock Boolean     @default(true)
  status      String      @default("ACTIVE")
  order_items OrderItem[]
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
}

model Order {
  id            String      @id @default(cuid())
  customer_id   String
  merchant_id   String
  merchant      Merchant    @relation(fields: [merchant_id], references: [id])
  total         Float
  items_summary String?
  status        OrderStatus @default(PENDING)
  alert_count   Int         @default(0)
  order_items   OrderItem[]
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
}

model OrderItem {
  id         String  @id @default(cuid())
  order_id   String
  order      Order   @relation(fields: [order_id], references: [id])
  product_id String
  product    Product @relation(fields: [product_id], references: [id])
  quantity   Int
  price      Float
}
